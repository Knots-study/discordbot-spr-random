#  Splatoon 武器ランダム選出 Discord Bot

Discordのボイスチャンネル参加者にSplatoon 3の武器をランダムに割り当てるBot。除外リスト機能と武器種別指定機能付き。

##  機能

- ボイスチャンネル参加者を自動検出して武器を割り当て
- メンション付きで結果を表示
- 使いたくない武器を除外リストで管理
- 武器種別（シューター、フデなど）で一括除外・追加が可能
- 武器種別を指定してランダム選出可能
- 🔄 リアクションで再抽選可能（20秒以内に1回のみ）
- 1️⃣2️⃣3️⃣ 番号リアクションで即座に武器を除外可能

##  コマンド

| コマンド | 説明 | 例 |
|---------|------|-----|
| `!random [種別]` | ボイスチャンネル参加者に武器を選出 | `!random` または `!random フデ` |
| `!remove [武器名/種別]` | 武器または武器種別を除外リストに追加 | `!remove わかばシューター` または `!remove シューター` |
| `!add [武器名/種別]` | 武器または武器種別を除外リストから削除 | `!add わかばシューター` または `!add シューター` |
| `!list` | 除外中の武器一覧を表示 | `!list` |
| `!all` | 全武器一覧を表示 | `!all` |
| `!clear` | 除外リストをクリア | `!clear` |
| `!help` | ヘルプを表示 | `!help` |

### 武器種別一覧

- シューター
- マニューバー
- ブラスター
- フデ
- ローラー
- スロッシャー
- シェルター
- スピナー
- チャージャー
- ストリンガー
- ワイパー

##  プロジェクト構成

```
discordbot-spr-random/
 src/
    commands/         # コマンド実装
    events/           # イベントハンドラー
    utils/            # 共通ユーティリティ
    db/
       migrations/   # Knexマイグレーション
       seeds/        # 初期データ
       connection.js # DB接続
    data/
       weapons.js    # 武器データ（160種類）
    database.js       # DB操作レイヤー
    index.js          # エントリーポイント
 tests/
    commands/         # コマンドテスト（コマンドごと）
    helpers/          # テストヘルパー
    *.test.js         # 各種ユニットテスト
 data/                 # SQLiteデータベースファイル
 knexfile.js           # Knex設定
 package.json
 .env                  # 環境変数（要作成）
```

##  使い方

### 基本的な流れ

1. ボイスチャンネルに参加
2. テキストチャンネルで `!random` と送信（または `!random フデ` など種別を指定）
3. Botが参加者全員に武器を割り当てて表示

### リアクション機能

選出結果のメッセージには自動でリアクションが追加されます：

- **🔄** を押すと再抽選（最初の20秒以内に1回のみ可能）
- **1️⃣ 2️⃣ 3️⃣...** 各番号を押すと該当する武器を除外リストに追加
  - 例: 2番目のプレイヤーに割り当てられた武器を除外したい → 2️⃣ を押す
  - 除外成功時は確認メッセージが表示されます

### 除外リスト管理

コマンドでも除外リストを管理できます：

```
!remove わかばシューター    # 個別の武器を除外
!remove シューター          # 種別全体を除外
!add わかばシューター       # 除外解除
!list                       # 除外中の武器を確認
!clear                      # 全て解除
```

##  技術スタック

- **Node.js** v24.11.0
- **Discord.js** v14.14.1 - リアクションイベント処理
- **Knex.js** v3.1.0 - クエリビルダー & マイグレーション
- **SQLite3** v5.1.7 - データ永続化
- **Vitest** v4.0.6 - テストフレームワーク（62テスト）
- **dotenv** v16.3.1 - 環境変数管理

##  開発

### テスト実行
```bash
npm test              # 全テスト実行
npm run test:watch    # 監視モード
```

### データベース管理
```bash
npm run migrate       # マイグレーション実行
npm run seed          # 初期データ投入
npm run db:reset      # DB完全リセット
```
